Description: CVE-2020-36280
   heap-based buffer over-read in pixReadFromTiffStream, related 
   to tiffio.c
Index: leptonlib-1.79.0/prog/dewarptest1.c
===================================================================
--- leptonlib-1.79.0.orig/prog/dewarptest1.c	2021-03-30 13:16:29.404452222 +0200
+++ leptonlib-1.79.0/prog/dewarptest1.c	2021-03-30 13:16:29.400452132 +0200
@@ -52,6 +52,8 @@
 
     setLeptDebugOK(1);
     lept_mkdir("lept/model");
+    lept_rmdir("lept/dewmod");
+    lept_mkdir("lept/dewmod");
 
 /*    pixs = pixRead("1555.007.jpg"); */
     pixs = pixRead("cat.035.jpg");
@@ -160,8 +162,6 @@
                       "/tmp/lept/dewarptest1.pdf");
     fprintf(stderr, "pdf file made: /tmp/lept/model/dewarptest1.pdf\n");
 
-    lept_rmdir("lept/dewmod");
-    lept_rmdir("lept/dewtest");
     pixDestroy(&pixs);
     pixDestroy(&pixn);
     pixDestroy(&pixg);
Index: leptonlib-1.79.0/src/tiffio.c
===================================================================
--- leptonlib-1.79.0.orig/src/tiffio.c	2021-03-30 13:16:29.404452222 +0200
+++ leptonlib-1.79.0/src/tiffio.c	2021-03-30 13:16:29.400452132 +0200
@@ -572,7 +572,7 @@
     } else if (spp == 2 && bps == 8) {  /* gray plus alpha */
         L_INFO("gray+alpha is not supported; converting to RGBA\n", procName);
         pixSetSpp(pix, 4);
-        linebuf = (l_uint8 *)LEPT_CALLOC(tiffbpl + 1, sizeof(l_uint8));
+        linebuf = (l_uint8 *)LEPT_CALLOC(2 * tiffbpl + 1, sizeof(l_uint8));
         pixdata = pixGetData(pix);
         for (i = 0; i < h; i++) {
             if (TIFFReadScanline(tif, linebuf, i, 0) < 0) {
